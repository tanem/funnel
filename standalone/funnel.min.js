(function(){function require(name){var module=require.modules[name];if(!module)throw new Error('failed to require "'+name+'"');if(!("exports"in module)&&typeof module.definition==="function"){module.client=module.component=true;module.definition.call(this,module.exports={},module);delete module.definition}return module.exports}require.modules={};require.register=function(name,definition){require.modules[name]={definition:definition}};require.define=function(name,exports){require.modules[name]={exports:exports}};require.register("component~domify@1.2.2",function(exports,module){module.exports=parse;var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"];map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"];map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"];map.text=map.circle=map.ellipse=map.line=map.path=map.polygon=map.polyline=map.rect=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];function parse(html){if("string"!=typeof html)throw new TypeError("String expected");var m=/<([\w:]+)/.exec(html);if(!m)return document.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if(tag=="body"){var el=document.createElement("html");el.innerHTML=html;return el.removeChild(el.lastChild)}var wrap=map[tag]||map._default;var depth=wrap[0];var prefix=wrap[1];var suffix=wrap[2];var el=document.createElement("div");el.innerHTML=prefix+html+suffix;while(depth--)el=el.lastChild;if(el.firstChild==el.lastChild){return el.removeChild(el.firstChild)}var fragment=document.createDocumentFragment();while(el.firstChild){fragment.appendChild(el.removeChild(el.firstChild))}return fragment}});require.register("segmentio~extend@1.0.0",function(exports,module){module.exports=function extend(object){var args=Array.prototype.slice.call(arguments,1);for(var i=0,source;source=args[i];i++){if(!source)continue;for(var property in source){object[property]=source[property]}}return object}});require.register("component~emitter@1.1.2",function(exports,module){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("component~query@0.0.3",function(exports,module){function one(selector,el){return el.querySelector(selector)}exports=module.exports=function(selector,el){el=el||document;return one(selector,el)};exports.all=function(selector,el){el=el||document;return el.querySelectorAll(selector)};exports.engine=function(obj){if(!obj.one)throw new Error(".one callback required");if(!obj.all)throw new Error(".all callback required");one=obj.one;exports.all=obj.all;return exports}});require.register("component~raf@1.1.3",function(exports,module){exports=module.exports=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||fallback;var prev=(new Date).getTime();function fallback(fn){var curr=(new Date).getTime();var ms=Math.max(0,16-(curr-prev));var req=setTimeout(fn,ms);prev=curr;return req}var cancel=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout;exports.cancel=function(id){cancel.call(window,id)}});require.register("danzajdband~random@master",function(exports,module){module.exports=function(min,max,truncate){min=min||0;max=max||min+1;if(truncate)return Math.floor(Math.random()*(max-min+1))+min;return Math.random()*(max-min)+min}});require.register("component~bind@0.0.1",function(exports,module){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=[].slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}});require.register("component~indexof@0.0.3",function(exports,module){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}});require.register("component~classes@1.2.1",function(exports,module){var index=require("component~indexof@0.0.3");var re=/\s+/;var toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el)};function ClassList(el){if(!el)throw new Error("A DOM element reference is required");this.el=el;this.list=el.classList}ClassList.prototype.add=function(name){if(this.list){this.list.add(name);return this}var arr=this.array();var i=index(arr,name);if(!~i)arr.push(name);this.el.className=arr.join(" ");return this};ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name)){return this.removeMatching(name)}if(this.list){this.list.remove(name);return this}var arr=this.array();var i=index(arr,name);if(~i)arr.splice(i,1);this.el.className=arr.join(" ");return this};ClassList.prototype.removeMatching=function(re){var arr=this.array();for(var i=0;i<arr.length;i++){if(re.test(arr[i])){this.remove(arr[i])}}return this};ClassList.prototype.toggle=function(name,force){if(this.list){if("undefined"!==typeof force){if(force!==this.list.toggle(name,force)){this.list.toggle(name)}}else{this.list.toggle(name)}return this}if("undefined"!==typeof force){if(!force){this.remove(name)}else{this.add(name)}}else{if(this.has(name)){this.remove(name)}else{this.add(name)}}return this};ClassList.prototype.array=function(){var str=this.el.className.replace(/^\s+|\s+$/g,"");var arr=str.split(re);if(""===arr[0])arr.shift();return arr};ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}});require.register("ianstormtaylor~to-no-case@0.1.0",function(exports,module){module.exports=toNoCase;var hasSpace=/\s/;var hasCamel=/[a-z][A-Z]/;var hasSeparator=/[\W_]/;function toNoCase(string){if(hasSpace.test(string))return string.toLowerCase();if(hasSeparator.test(string))string=unseparate(string);if(hasCamel.test(string))string=uncamelize(string);return string.toLowerCase()}var separatorSplitter=/[\W_]+(.|$)/g;function unseparate(string){return string.replace(separatorSplitter,function(m,next){return next?" "+next:""})}var camelSplitter=/(.)([A-Z]+)/g;function uncamelize(string){return string.replace(camelSplitter,function(m,previous,uppers){return previous+" "+uppers.toLowerCase().split("").join(" ")})}});require.register("ianstormtaylor~to-space-case@0.1.2",function(exports,module){var clean=require("ianstormtaylor~to-no-case@0.1.0");module.exports=toSpaceCase;function toSpaceCase(string){return clean(string).replace(/[\W_]+(.|$)/g,function(matches,match){return match?" "+match:""})}});require.register("ianstormtaylor~to-camel-case@0.2.1",function(exports,module){var toSpace=require("ianstormtaylor~to-space-case@0.1.2");module.exports=toCamelCase;function toCamelCase(string){return toSpace(string).replace(/\s(\w)/g,function(matches,letter){return letter.toUpperCase()})}});require.register("component~within-document@0.0.1",function(exports,module){module.exports=function(el){var node=el;while(node=node.parentNode){if(node==document)return true}return false}});require.register("component~props@1.1.2",function(exports,module){var globals=/\b(this|Array|Date|Object|Math|JSON)\b/g;module.exports=function(str,fn){var p=unique(props(str));if(fn&&"string"==typeof fn)fn=prefixed(fn);if(fn)return map(str,p,fn);return p};function props(str){return str.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(globals,"").match(/[$a-zA-Z_]\w*/g)||[]}function map(str,props,fn){var re=/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g;return str.replace(re,function(_){if("("==_[_.length-1])return fn(_);if(!~props.indexOf(_))return _;return fn(_)})}function unique(arr){var ret=[];for(var i=0;i<arr.length;i++){if(~ret.indexOf(arr[i]))continue;ret.push(arr[i])}return ret}function prefixed(str){return function(_){return str+_}}});require.register("component~to-function@2.0.0",function(exports,module){var expr=require("component~props@1.1.2");module.exports=toFunction;function toFunction(obj){switch({}.toString.call(obj)){case"[object Object]":return objectToFunction(obj);case"[object Function]":return obj;case"[object String]":return stringToFunction(obj);case"[object RegExp]":return regexpToFunction(obj);default:return defaultToFunction(obj)}}function defaultToFunction(val){return function(obj){return val===obj}}function regexpToFunction(re){return function(obj){return re.test(obj)}}function stringToFunction(str){if(/^ *\W+/.test(str))return new Function("_","return _ "+str);return new Function("_","return "+get(str))}function objectToFunction(obj){var match={};for(var key in obj){match[key]=typeof obj[key]==="string"?defaultToFunction(obj[key]):toFunction(obj[key])}return function(val){if(typeof val!=="object")return false;for(var key in match){if(!(key in val))return false;if(!match[key](val[key]))return false}return true}}function get(str){var props=expr(str);if(!props.length)return"_."+str;var val;for(var i=0,prop;prop=props[i];i++){val="_."+prop;val="('function' == typeof "+val+" ? "+val+"() : "+val+")";str=str.replace(new RegExp(prop,"g"),val)}return str}});require.register("component~type@1.0.0",function(exports,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if(val===null)return"null";if(val===undefined)return"undefined";if(val&&val.nodeType===1)return"element";if(val===Object(val))return"object";return typeof val}});require.register("component~each@0.2.3",function(exports,module){var type=require("component~type@1.0.0");var toFunction=require("component~to-function@2.0.0");var has=Object.prototype.hasOwnProperty;module.exports=function(obj,fn,ctx){fn=toFunction(fn);ctx=ctx||this;switch(type(obj)){case"array":return array(obj,fn,ctx);case"object":if("number"==typeof obj.length)return array(obj,fn,ctx);return object(obj,fn,ctx);case"string":return string(obj,fn,ctx)}};function string(obj,fn,ctx){for(var i=0;i<obj.length;++i){fn.call(ctx,obj.charAt(i),i)}}function object(obj,fn,ctx){for(var key in obj){if(has.call(obj,key)){fn.call(ctx,key,obj[key])}}}function array(obj,fn,ctx){for(var i=0;i<obj.length;++i){fn.call(ctx,obj[i],i)}}});require.register("visionmedia~debug@0.8.1",function(exports,module){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}});require.register("component~css@0.0.5",function(exports,module){var debug=require("visionmedia~debug@0.8.1")("css");var set=require("component~css@0.0.5/lib/style.js");var get=require("component~css@0.0.5/lib/css.js");module.exports=css;function css(el,prop,val){if(!el)return;if(undefined!==val){var obj={};obj[prop]=val;debug("setting styles %j",obj);return setStyles(el,obj)}if("object"==typeof prop){debug("setting styles %j",prop);return setStyles(el,prop)}debug("getting %s",prop);return get(el,prop)}function setStyles(el,props){for(var prop in props){set(el,prop,props[prop])}return el}});require.register("component~css@0.0.5/lib/css.js",function(exports,module){var debug=require("visionmedia~debug@0.8.1")("css:css");var camelcase=require("ianstormtaylor~to-camel-case@0.2.1");var computed=require("component~css@0.0.5/lib/computed.js");var property=require("component~css@0.0.5/lib/prop.js");module.exports=css;var cssNormalTransform={letterSpacing:0,fontWeight:400};function css(el,prop,extra,styles){var hooks=require("component~css@0.0.5/lib/hooks.js");var orig=camelcase(prop);var style=el.style;var val;prop=property(prop,style);var hook=hooks[prop]||hooks[orig];if(hook&&hook.get){debug("get hook provided. use that");val=hook.get(el,true,extra)}if(undefined==val){debug("fetch the computed value of %s",prop);val=computed(el,prop)}if("normal"==val&&cssNormalTransform[prop]){val=cssNormalTransform[prop];debug("normal => %s",val)}if(""==extra||extra){debug("converting value: %s into a number",val);var num=parseFloat(val);return true===extra||isNumeric(num)?num||0:val}return val}function isNumeric(obj){return!isNan(parseFloat(obj))&&isFinite(obj)}});require.register("component~css@0.0.5/lib/prop.js",function(exports,module){var debug=require("visionmedia~debug@0.8.1")("css:prop");var camelcase=require("ianstormtaylor~to-camel-case@0.2.1");var vendor=require("component~css@0.0.5/lib/vendor.js");module.exports=prop;var cssProps={"float":"cssFloat"in document.documentElement.style?"cssFloat":"styleFloat"};function prop(prop,style){prop=cssProps[prop]||(cssProps[prop]=vendor(prop,style));debug("transform property: %s => %s",prop,style);return prop}});require.register("component~css@0.0.5/lib/swap.js",function(exports,module){module.exports=swap;function swap(el,options,fn,args){for(var key in options){old[key]=el.style[key];el.style[key]=options[key]}ret=fn.apply(el,args||[]);for(key in options){el.style[key]=old[key]}return ret}});require.register("component~css@0.0.5/lib/style.js",function(exports,module){var debug=require("visionmedia~debug@0.8.1")("css:style");var camelcase=require("ianstormtaylor~to-camel-case@0.2.1");var support=require("component~css@0.0.5/lib/support.js");var property=require("component~css@0.0.5/lib/prop.js");var hooks=require("component~css@0.0.5/lib/hooks.js");module.exports=style;var cssNumber={columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true};function style(el,prop,val,extra){if(!el||el.nodeType===3||el.nodeType===8||!el.style)return;var orig=camelcase(prop);var style=el.style;var type=typeof val;if(!val)return get(el,prop,orig,extra);prop=property(prop,style);var hook=hooks[prop]||hooks[orig];if("number"==type&&!cssNumber[orig]){debug('adding "px" to end of number');val+="px"}if(!support.clearCloneStyle&&""===val&&0===prop.indexOf("background")){debug('set property (%s) value to "inherit"',prop);style[prop]="inherit"}if(!hook||!hook.set||undefined!==(val=hook.set(el,val,extra))){debug("set hook defined. setting property (%s) to %s",prop,val);style[prop]="";style[prop]=val}}function get(el,prop,orig,extra){var style=el.style;var hook=hooks[prop]||hooks[orig];var ret;if(hook&&hook.get&&undefined!==(ret=hook.get(el,false,extra))){debug("get hook defined, returning: %s",ret);return ret}ret=style[prop];debug("getting %s",ret);return ret}});require.register("component~css@0.0.5/lib/hooks.js",function(exports,module){var each=require("component~each@0.2.3");var css=require("component~css@0.0.5/lib/css.js");var cssShow={position:"absolute",visibility:"hidden",display:"block"};var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var rnumsplit=new RegExp("^("+pnum+")(.*)$","i");var rdisplayswap=/^(none|table(?!-c[ea]).+)/;var styles=require("component~css@0.0.5/lib/styles.js");var support=require("component~css@0.0.5/lib/support.js");var swap=require("component~css@0.0.5/lib/swap.js");var computed=require("component~css@0.0.5/lib/computed.js");var cssExpand=["Top","Right","Bottom","Left"];each(["width","height"],function(name){exports[name]={};exports[name].get=function(el,compute,extra){if(!compute)return;return 0==el.offsetWidth&&rdisplayswap.test(css(el,"display"))?swap(el,cssShow,function(){return getWidthOrHeight(el,name,extra)}):getWidthOrHeight(el,name,extra)};exports[name].set=function(el,val,extra){var styles=extra&&styles(el);return setPositiveNumber(el,val,extra?augmentWidthOrHeight(el,name,extra,"border-box"==css(el,"boxSizing",false,styles),styles):0)}});exports.opacity={};exports.opacity.get=function(el,compute){if(!compute)return;var ret=computed(el,"opacity");return""==ret?"1":ret};function setPositiveNumber(el,val,subtract){var matches=rnumsplit.exec(val);return matches?Math.max(0,matches[1])+(matches[2]||"px"):val}function getWidthOrHeight(el,prop,extra){var valueIsBorderBox=true;var val=prop==="width"?el.offsetWidth:el.offsetHeight;var styles=computed(el);var isBorderBox=support.boxSizing&&css(el,"boxSizing")==="border-box";if(val<=0||val==null){val=computed(el,prop,styles);if(val<0||val==null){val=el.style[prop]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===el.style[prop]);val=parseFloat(val)||0}extra=extra||(isBorderBox?"border":"content");val+=augmentWidthOrHeight(el,prop,extra,valueIsBorderBox,styles);return val+"px"}function augmentWidthOrHeight(el,prop,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:"width"==prop?1:0;var val=0;for(;i<4;i+=2){if(extra==="margin"){val+=css(el,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=css(el,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=css(el,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=css(el,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=css(el,"border"+cssExpand[i]+"Width",true,styles)}}}return val}});require.register("component~css@0.0.5/lib/styles.js",function(exports,module){module.exports=styles;function styles(el){if(window.getComputedStyle){return el.ownerDocument.defaultView.getComputedStyle(el,null)}else{return el.currentStyle}}});require.register("component~css@0.0.5/lib/vendor.js",function(exports,module){var prefixes=["Webkit","O","Moz","ms"];module.exports=vendor;function vendor(prop,style){if(style[prop])return prop;var capName=prop[0].toUpperCase()+prop.slice(1);var original=prop;var i=prefixes.length;while(i--){prop=prefixes[i]+capName;if(prop in style)return prop}return original}});require.register("component~css@0.0.5/lib/support.js",function(exports,module){var reliableMarginRight;var boxSizingReliableVal;var pixelPositionVal;var clearCloneStyle;var docElem=document.documentElement;var container=document.createElement("div");var div=document.createElement("div");div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";exports.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";container.appendChild(div);exports.pixelPosition=function(){if(undefined==pixelPositionVal)computePixelPositionAndBoxSizingReliable();return pixelPositionVal};exports.boxSizingReliable=function(){if(undefined==boxSizingReliableVal)computePixelPositionAndBoxSizingReliable();return boxSizingReliableVal};exports.reliableMarginRight=function(){var ret;var marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";docElem.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight);docElem.removeChild(container);div.innerHTML="";return ret};function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;"+"position:absolute;top:1%";docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%";boxSizingReliableVal=divStyle.width==="4px";docElem.removeChild(container)}});require.register("component~css@0.0.5/lib/computed.js",function(exports,module){var debug=require("visionmedia~debug@0.8.1")("css:computed");var withinDocument=require("component~within-document@0.0.1");var styles=require("component~css@0.0.5/lib/styles.js");module.exports=computed;function computed(el,prop,precomputed){var computed=precomputed||styles(el);var ret;if(!computed)return;if(computed.getPropertyValue){ret=computed.getPropertyValue(prop)||computed[prop]}else{ret=computed[prop]}if(""===ret&&!withinDocument(el)){debug("element not within document, try finding from style attribute");var style=require("component~css@0.0.5/lib/style.js");ret=style(el,prop)}debug("computed value of %s: %s",prop,ret);return undefined===ret?ret:ret+""}});require.register("funnel",function(exports,module){"use strict";var extend=require("segmentio~extend@1.0.0");var domify=require("component~domify@1.2.2");var query=require("component~query@0.0.3");var funnelTemplate=require("funnel/templates/funnel.html");var StepsCollection=require("funnel/src/stepsCollection.js");var StepModel=require("funnel/src/stepModel.js");var StepView=require("funnel/src/stepView.js");var viewUtils=require("funnel/src/viewUtils.js");module.exports=Funnel;function Funnel(){this.el=domify(funnelTemplate);this.nameEl=query(".js-funnel-name",this.el);this.listEl=query(".js-funnel-list",this.el);this.completionEl=query(".js-funnel-item-completion",this.el);this.conversionEl=query(".js-funnel-conversion",this.el);this.stepsCollection=new StepsCollection;this._name="";this.stepViews=[]}Funnel.prototype.name=function(name){this.nameEl.textContent=name;return this};Funnel.prototype.step=function(opts){var defaultModelOpts={hits:0,trend:0,conversion:0};if(this.stepsCollection.models.length===0)defaultModelOpts={hits:0,conversion:0};var stepModel=new StepModel(extend(opts,defaultModelOpts));this.stepsCollection.add(stepModel);var stepView=new StepView(stepModel);this.listEl.insertBefore(stepView.el,this.completionEl);this.stepViews.push(stepView);return this};Funnel.prototype.hit=function(url){var isMatched;this.stepsCollection.models.forEach(function(stepModel,i,models){if(stepModel.get("url")===url){isMatched=true;var newHits=stepModel.get("hits")+1;stepModel.set("hits",newHits);stepModel.set("conversion",this._getRatio(newHits,models[0].get("hits")));if(i-1>=0)stepModel.set("trend",this._getTrend(newHits,models[i-1].get("hits")))}else if(isMatched){stepModel.set("conversion",this._getRatio(stepModel.get("hits"),models[0].get("hits")));stepModel.set("trend",this._getTrend(stepModel.get("hits"),models[i-1].get("hits")))}if(i+1>=models.length){this.conversionEl.textContent=viewUtils.formatAsPercentage(stepModel.get("conversion"),1)}},this);return this};Funnel.prototype._getRatio=function(valueA,valueB){return valueA>=valueB?1:valueA/valueB};Funnel.prototype._getTrend=function(valueA,valueB){var ratio=this._getRatio(valueA,valueB);return ratio===1?1:ratio-1};Funnel.prototype.remove=function(){this.stepViews.forEach(function(stepView){stepView.remove()})}});require.register("funnel/src/stepModel.js",function(exports,module){var Emitter=require("component~emitter@1.1.2");module.exports=StepModel;function StepModel(opts){Emitter(this);opts=opts||{};this.set(opts)}StepModel.prototype.set=function(attr,val){var attrs;if(typeof attr==="object"){attrs=attr}else{attrs={};attrs[attr]=val}Object.keys(attrs).forEach(function(key){var val=attrs[key];if(this[key]!==val){this[key]=attrs[key];this.emit("change:"+key,val)}},this)};StepModel.prototype.get=function(attr){return this[attr]}});require.register("funnel/src/stepsCollection.js",function(exports,module){var Emitter=require("component~emitter@1.1.2");module.exports=StepsCollection;function StepsCollection(){Emitter(this);this.models=[]}StepsCollection.prototype.add=function(model){this.models.push(model)}});require.register("funnel/src/stepView.js",function(exports,module){var query=require("component~query@0.0.3");var domify=require("component~domify@1.2.2");var bind=require("component~bind@0.0.1");var stepTemplate=require("funnel/templates/step.html");var viewUtils=require("funnel/src/viewUtils.js");module.exports=StepView;function StepView(model){this.model=model;this.model.on("change:label",bind(this,this._changeLabelHandler));this.model.on("change:hits",bind(this,this._changeHitsHandler));this.model.on("change:conversion",bind(this,this._changeConversionHandler));this.el=domify(stepTemplate);this.labelEl=query(".js-funnel-item-label",this.el);this.hitsEl=query(".js-funnel-item-hits",this.el);this.trendWrapperEl=query(".js-funnel-item-trend-wrapper",this.el);this.barEl=query(".js-funnel-item-bar",this.el);this.conversionEl=query(".js-funnel-item-conversion",this.el);this._changeLabelHandler(this.model.get("label"));this._changeHitsHandler(this.model.get("hits"));this._changeConversionHandler(this.model.get("conversion"));if(this.model.get("trend")!==void 0){this.trendWrapperEl.classList.remove("is-hidden");this.model.on("change:trend",bind(this,this._changeTrendHandler));this.trendEl=query(".js-funnel-item-trend",this.el);this._changeTrendHandler(this.model.get("trend"))}}StepView.prototype.remove=function(){this.model.removeAllListeners()};StepView.prototype._changeLabelHandler=function(label){this.labelEl.textContent=label};StepView.prototype._changeHitsHandler=function(hits){this.hitsEl.textContent=hits};StepView.prototype._changeTrendHandler=function(trend){this.trendEl.textContent=viewUtils.formatAsPercentage(trend,1)};StepView.prototype._changeConversionHandler=function(conversion){this.barEl.style.width=viewUtils.formatAsPercentage(conversion,1);this.conversionEl.textContent=viewUtils.formatAsPercentage(conversion,1)}});require.register("funnel/src/viewUtils.js",function(exports,module){exports.formatAsPercentage=function(val,dp){return Math.round(val*100*Math.pow(10,dp))/Math.pow(10,dp)+"%"}});require.define("funnel/templates/funnel.html",'<div class="funnel">\n  <h2 class="js-funnel-name funnel-name"></h2>\n  <ol class="js-funnel-list funnel-list">\n    <li class="js-funnel-item-completion funnel-item">\n      <div class="funnel-item-label-wrapper">\n        <span class="funnel-item-label">Completion rate</span>\n      </div>\n      <div class="funnel-conversion-wrapper">\n        <span class="js-funnel-conversion funnel-conversion">0%</span>\n      </div>\n    </li>\n  </ol>\n</div>');require.define("funnel/templates/step.html",'<li class="funnel-item">\n  <div class="funnel-item-label-wrapper">\n    <span class="js-funnel-item-label funnel-item-label"></span>\n    <span class="funnel-item-metadata"><span class="js-funnel-item-hits">80,000</span><span class="js-funnel-item-trend-wrapper is-hidden"> / <span class="js-funnel-item-trend">-20%</span></span></span>\n  </div>\n  <div class="funnel-item-bar-wrapper">\n    <div class="js-funnel-item-bar funnel-item-bar"></div>\n    <span class="js-funnel-item-conversion funnel-item-conversion"></span>\n  </div>\n</li>');if(typeof exports=="object"){module.exports=require("funnel")}else if(typeof define=="function"&&define.amd){define([],function(){return require("funnel")})}else{this["Funnel"]=require("funnel")}})();